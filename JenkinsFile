pipeline {
    agent any

    stages {
        stage('pull code') {
            steps {
                checkout([$class: 'GitSCM', branches: [[name: '*/main']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: '5629358b-eddb-4117-aa55-6e786b1ffff3', url: 'https://github.com/lucifer-gg/TestForJenkins.git']]])
            }
        }
        stage('build image') {
            steps {
                sh 'mvn clean package dockerfile:build'
            }
        }
        stage('build container') {
                    steps {
                        sh '''
                        CID=$(docker ps -a | grep -w oasis:latest | awk '{print $1}')
                        if [ -z "$CID"]
                         then
                            echo 'has stopped'
                        else
                            docker stop $CID
                            docker rm $CID
                        fi
                         docker run -di -p 8081:8081 oasis:latest
                        '''
                    }
                }
    }
}
